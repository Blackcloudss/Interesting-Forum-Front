Page({
  data: {
    navScrollLeft: 0,
    navItems: ['资料分享', '课程评价', '赛事大全', '答疑解惑'],
    posts: {
      '资料分享': [
        
        {
          id:1,
          avatar: '/图片素材/莞工趣谈/首页/头像3.png',
          avatarl:'/图片素材/莞工趣谈/首页/2-3学习交流/组件/资料分享.png',
          username: 'Pursue',
          time: '刚刚',
          content: '求备用机,有没有出苹果手机备用机的友友',
          likes: 0,
          comments: 0,
        },
        {
          id:2,
          avatar: '/图片素材/莞工趣谈/首页/2-2校园生活/头像2.png',
          avatarl:'/图片素材/莞工趣谈/首页/2-3学习交流/组件/资料分享.png',
          username: '折星',
          time: '1分钟前',
          content: '低价出最新国考,粉笔教资,专四专八等资料',
          likes: 1,
          comments: 1,
        },
        {
          id:3,
          avatar: '/图片素材/莞工趣谈/首页/2-2校园生活/头像3.png',
          avatarl:'/图片素材/莞工趣谈/首页/2-3学习交流/组件/资料分享.png',
          username: '邶邶',
          time: '2分钟前',
          content: '20r出一个全新的电脑支架',
          likes: 2,
          comments: 2,
        },
        {
          id:4,
          avatar: '/图片素材/莞工趣谈/首页/2-2校园生活/头像4.png',
          avatarl:'/图片素材/莞工趣谈/首页/2-3学习交流/组件/资料分享.png',
          username: '豆浆',
          time: '1天前',
          content: '出《哪吒2》电影票,地点:佳纷天地',
          likes: 3,
          comments: 3,
        },
        {
          id:5,
          avatar: '/图片素材/莞工趣谈/首页/2-2校园生活/头像5.png',
          avatarl:'/图片素材/莞工趣谈/首页/2-3学习交流/组件/资料分享.png',
          username: '邹围有燕子的晴天',
          time: '2天前',
          content: '出一张办公椅,50r,可小刀',
          likes: 4,
          comments: 4,
        },
        {
          id:6,
          avatar: '/图片素材/莞工趣谈/首页/头像3.png',
          avatarl:'/图片素材/莞工趣谈/首页/2-3学习交流/组件/资料分享.png',
          username: 'Pursue',
          time: '3天前',
          content: '求大二下册网络安全专业的教材',
          likes: 5,
          comments: 5,
        }

      ],
      '课程评价': [
        {
          id:7,
          avatar: '/图片素材/莞工趣谈/首页/头像3.png',
          avatarl:'/图片素材/莞工趣谈/首页/2-3学习交流/组件/课程评价.png',
          username: 'Pursue',
          time: '刚刚',
          content: '丢失一把钥匙🔑,二饭附近',
          likes: 0,
          comments: 0,
        },
        {
          id:8,
          avatar: '/图片素材/莞工趣谈/首页/2-2校园生活/头像2.png',
          avatarl:'/图片素材/莞工趣谈/首页/2-3学习交流/组件/课程评价.png',
          username: '折星',
          time: '1分钟前',
          content: '捡到一本《高等数学》上册的书📖,在图书馆门口',
          likes: 1,
          comments: 1,
        },
        {
          id:9,
          avatar: '/图片素材/莞工趣谈/首页/2-2校园生活/头像3.png',
          avatarl:'/图片素材/莞工趣谈/首页/2-3学习交流/组件/课程评价.png',
          username: '邶邶',
          time: '2分钟前',
          content: '黑色杯子,操场旁边丢失',
          likes: 2,
          comments: 2,
        },
        {
          id:10,
          avatar: '/图片素材/莞工趣谈/首页/2-2校园生活/头像4.png',
          avatarl:'/图片素材/莞工趣谈/首页/2-3学习交流/组件/课程评价.png',
          username: '豆浆',
          time: '1天前',
          content: '在体育馆旁边捡到粉色耳机,遗失者可联系',
          likes: 3,
          comments: 3,
        },
        {
          id:11,
          avatar: '/图片素材/莞工趣谈/首页/2-2校园生活/头像5.png',
          avatarl:'/图片素材/莞工趣谈/首页/2-3学习交流/组件/课程评价.png',
          username: '邹围有燕子的晴天',
          time: '2天前',
          content: '教学楼6a遗失白色书包',
          likes: 4,
          comments: 4,
        },
        {
          id:12,
          avatar: '/图片素材/莞工趣谈/首页/头像3.png',
          avatarl:'/图片素材/莞工趣谈/首页/2-3学习交流/组件/课程评价.png',
          username: 'Pursue',
          time: '3天前',
          content: '谁在一饭二楼椅子上看见一把有粉色爱心的雨伞🥹🥹',
          likes: 5,
          comments: 5,
        }
      ],
      '赛事大全': [
        {
          id:13,
          avatar: '/图片素材/莞工趣谈/首页/头像3.png',
          avatarl:'/图片素材/莞工趣谈/首页/2-3学习交流/组件/赛事大全.png',
          username: 'Pursue',
          time: '刚刚',
          content: '有闲置厚衣服的同学可以捐给流浪动物，一起递温暖',
          likes: 0,
          comments: 0,
        },
        {
          id:14,
          avatar: '/图片素材/莞工趣谈/首页/2-2校园生活/头像2.png',
           avatarl:'/图片素材/莞工趣谈/首页/2-3学习交流/组件/赛事大全.png',
          username: '折星',
          time: '1分钟前',
          content: '体育馆围栏里有只流浪狗被困，急需救助，有爱心人士请帮忙，一起拯救它！',
          likes: 1,
          comments: 1,
        },
        {
          id:15,
          avatar: '/图片素材/莞工趣谈/首页/2-2校园生活/头像3.png',
           avatarl:'/图片素材/莞工趣谈/首页/2-3学习交流/组件/赛事大全.png',
          username: '邶邶',
          time: '2分钟前',
          content: '某同学家庭变故，生活困难，希望有同学能捐赠生活用品或提供帮助',
          likes: 2,
          comments: 2,
        },
        {
          id:16,
          avatar: '/图片素材/莞工趣谈/首页/2-2校园生活/头像4.png',
         avatarl:'/图片素材/莞工趣谈/首页/2-3学习交流/组件/赛事大全.png',
          username: '豆浆',
          time: '1天前',
          content: '莞馨社区楼下小猫急需避寒小窝，今晚暂存柜见，一起用纸箱旧衣服DIY猫屋！',
          likes: 3,
          comments: 3,
        },
        {
          id:17,
          avatar: '/图片素材/莞工趣谈/首页/2-2校园生活/头像5.png',
         avatarl:'/图片素材/莞工趣谈/首页/2-3学习交流/组件/赛事大全.png',
          username: '邹围有燕子的晴天',
          time: '2天前',
          content: '回收闲置冬衣&棉衣，清洗后赠与困难同学',
          likes: 4,
          comments: 4,
        },
        {
          id:18,
          avatar: '/图片素材/莞工趣谈/首页/头像3.png',
         avatarl:'/图片素材/莞工趣谈/首页/2-3学习交流/组件/赛事大全.png',
          username: 'Pursue',
          time: '3天前',
          content: '那只黄色的胖猫有猫瘟，虽然猫瘟不会对人有影响，但是对其他小猫有影响，请大家摸完后洗手再摸其他小猫咪',
          likes: 5,
          comments: 5,
        }
      ],
      '答疑解惑': [
        {
          id:19,
          avatar: '/图片素材/莞工趣谈/首页/头像3.png',
          avatarl:'/图片素材/莞工趣谈/首页/2-3学习交流/组件/答疑解惑.png',
          username: 'Pursue',
          time: '刚刚',
          content: '四饭的“千里香”馄饨店超好吃，推荐同学们去',
          likes: 0,
          comments: 0,
        },
        {
          id:20,
          avatar: '/图片素材/莞工趣谈/首页/2-2校园生活/头像2.png',
          avatarl:'/图片素材/莞工趣谈/首页/2-3学习交流/组件/答疑解惑.png',
          username: '折星',
          time: '1分钟前',
          content: '校园周边剧本杀探店，哪家的DM会带，求推',
          likes: 1,
          comments: 1,
        },
        {
          id:21,
          avatar: '/图片素材/莞工趣谈/首页/2-2校园生活/头像3.png',
          avatarl:'/图片素材/莞工趣谈/首页/2-3学习交流/组件/答疑解惑.png',
          username: '邶邶',
          time: '2分钟前',
          content: '解锁校园美食新地标，松山湖万科的烤鱼很香很好吃！',
          likes: 2,
          comments: 2,
        },
        {
          id:22,
          avatar: '/图片素材/莞工趣谈/首页/2-2校园生活/头像4.png',
          avatarl:'/图片素材/莞工趣谈/首页/2-3学习交流/组件/答疑解惑.png',
          username: '豆浆',
          time: '1天前',
          content: '谁懂啊，广隆蛋挞王的芋泥厚蛋糕绝了！蛋挞也很香！',
          likes: 3,
          comments: 3,
        },
        {
          id:23,
          avatar: '/图片素材/莞工趣谈/首页/2-2校园生活/头像5.png',
          avatarl:'/图片素材/莞工趣谈/首页/2-3学习交流/组件/答疑解惑.png',
          username: '邹围有燕子的晴天',
          time: '2天前',
          content: '周末打羽毛球，找搭子，女生',
          likes: 4,
          comments: 4,
        },
        {
          id:24,
          avatar: '/图片素材/莞工趣谈/首页/头像3.png',
          avatarl:'/图片素材/莞工趣谈/首页/2-3学习交流/组件/答疑解惑.png',
          username: 'Pursue',
          time: '3天前',
          content: '求搭子，去探索周边美食',
          likes: 5,
          comments: 5,
        }
      ]
      
    },
    currentCategory: 0, // 默认选中“二手交易”
    currentPosts: []
  
  },
  
  onNavItemTap(e) {
    const index = e.currentTarget.dataset.index;
    this.setData({
      currentCategory: index
    });
    this.showPostsByCategory(index);
    
  },

    showPostsByCategory(categoryIndex) {
      const categoryKey = this.data.navItems[categoryIndex];
      this.setData({
        currentPosts: this.data.posts[categoryKey]
      });
  },
  onLoad() {
    // 页面加载时显示默认分类的帖子
    this.showPostsByCategory(this.data.currentCategory);
  },
  
  onCommentTap(e) {
    const index = e.currentTarget.dataset.index;
    wx.showToast({
      title: `评论 ${this.data.posts[index].user}`,
      icon: 'none'
    });
  },
  // 定义 handleLike 方法
  handleLike(e) {
    const postId = e.currentTarget.dataset.id;
    const currentPosts = this.data.currentPosts;
    const updatedPosts = currentPosts.map(post => {
      if (post.id === postId) {
        return { ...post, likes: post.likes + 1 };
      }
      return post;
    });
    this.setData({ currentPosts: updatedPosts });
    const post = updatedPosts.find(p => p.id === postId);
    this.updateLike(postId, post.likes);
  },
  updateLike(postId, likes) {
    // 示例中的网络请求
    wx.request({
      url: 'https://your-backend-api/update_likes', // 替换为你的后端 API 地址
      method: 'POST',
      data: {
        postId,
        likes
      },
      success: (res) => {
        console.log('点赞成功，后台已更新：', res.data);
        // 可以在这里提示用户
        wx.showToast({
          title: '点赞成功',
          icon: 'success'
        });
      },
      fail: (err) => {
        console.error('点赞失败：', err);
        wx.showToast({
          title: '点赞失败',
          icon: 'none'
        });
      }
    });
  }
});